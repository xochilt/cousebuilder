<!--

  Copyright 2015 Google Inc. All Rights Reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

-->

<link rel="import" href="/modules/guide/resources/polymer/bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/iron-localstorage/iron-localstorage.html">

<link rel="import" href="/modules/guide/resources/polymer/bower_components/neon-animation/animations/slide-from-right-animation.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/neon-animation/animations/slide-from-left-animation.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/neon-animation/animations/slide-right-animation.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/neon-animation/animations/slide-left-animation.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/neon-animation/neon-animated-pages.html">

<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-button/paper-button.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-item/paper-item.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-menu/paper-menu.html">
<link rel="import" href="/modules/guide/resources/polymer/bower_components/paper-toolbar/paper-toolbar.html">

<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Source+Code+Pro'>

<dom-module id="shared-style">
  <template>
    <style>
      /* Theming - Custom CSS  properties */
      :root {
        --paper-radio-button-checked-ink-color: #4285f4;
        --paper-radio-button-checked-color: #4285f4;
        --paper-radio-button-unchecked-color: #4285f4;

        --text-font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial;
        --text-font-size: 14px;
        --text-font-weight: 200;
      }

      /* Components' shared styles */
      :host {
        font-family: var(--text-font-family);
        font-size: var(--text-font-size);
        font-weight: var(--text-font-weight);
      }

      /* Document styles */
      /* TODO: Consider moving to site and preview projects. */
      body {
        font-family: var(--text-font-family);
        font-size: var(--text-font-size);
        font-weight: var(--text-font-weight);
      }
    </style>
  </template>
</dom-module>

<dom-module id="gcb-step-card">
  <template>
    <style include="shared-style"></style>
    <style>
      :host {
        --gcb-step-card-background: #fff;
        --gcb-step-card-link-color: #0097A7;
        --gcb-step-card-footer-text-color: #777;
        --gcb-step-card-note: {};
        --gcb-step-card-tip: {};
        --gcb-step-card-warn: {};
        --gcb-step-card-callout: {};
        --gcb-step-card-code: {};
      }

      :host {
        line-height: 24px;
      }

      #title {
        font-size: 28px;
        font-weight: 400;
        line-height: 1em;
        margin: 0 0 30px;
      }

      .instructions {
        margin: 16px;
        box-shadow: 1px 1px 16px #CCC;
        background: var(--gcb-step-card-background);
        max-width: 800px;
        font-size: 14px;
        line-height: 1.5;
      }

      .instructions .inner {
        padding: 24px;
      }

      footer {
        color: var(--gcb-step-card-footer-text-color);
        height: 120px;
        max-width: 800px;
      }

      footer a,
      footer a:visited {
        color: var(--gcb-step-card-footer-text-color);
      }

      #feedback {
        text-align: center;
        font-size: 0.9em;
      }

      .instructions ::content a,
      .instructions ::content a:visited {
        color: var(--gcb-step-card-link-color);
      }

      .instructions ::content h2,
      .instructions ::content h3,
      .instructions ::content h4 {
        font-weight: 400;
        margin: 0;
      }

      .instructions ::content h2 {
        font-weight: 300;
        line-height: 1em;
        font-size: 22px;
      }

      .instructions ::content {
        line-height: 24px;
      }

      .instructions ::content li {
        margin: 0.5em 0;
      }

      .instructions ::content h2 {
        font-weight: 500;
        margin: 1.5em 0 0 0;
        font-size: 20px;
      }

      .instructions ::content h3 {
        font-weight: 500;
        margin: 20px 0 0 0;
      }

      .instructions ::content aside {
        padding: 0.5em 1em;
        margin: 2em 0;
        border-left: 4px solid;
      }

      .instructions ::content aside p {
        margin: 0.5em 0;
      }

      .instructions ::content aside.note,
      .instructions ::content aside.notice {
        border-color: #fca;
        background: #fed;
        color: #842;
        @apply(--gcb-step-card-note);
      }

      .instructions ::content aside.tip,
      .instructions ::content aside.special {
        border-color: #6a6;
        background: #ded;
        color: #464;
        @apply(--gcb-step-card-tip);
      }

      .instructions ::content aside.warning {
        border-color: #DB8A61;
        background: #fed;
        color: #842;
        @apply(--gcb-step-card-warn);
      }

      .instructions ::content aside.callout {
        background-color: #f4f8fa;
        margin: 20px 0;
        padding: 15px;
        border-left: 3px solid #4f7dc9;
        font-size: 14px;
        line-height: 1.5;
        @apply(--gcb-step-card-callout);
      }

      .instructions ::content aside.callout b {
        color: #4f7dc9;
      }

      .instructions ::content ul.checklist {
        list-style: none;
        padding: 0 0 0 1em;
      }

      .instructions ::content ul.checklist li {
        padding-left: 24px;
        background-size: 20px;
        background-repeat: no-repeat;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAWlBMVEUAAAAxokwwoks1pFAxokwxokwxokwxokwxokwnnkQnnkQnnkRou3y84cTS69cxokwonkQxokwnnkRqvH1VsmtluXlVsmsnnkRdtnLw+PIxokwqn0YinEAfmj3goh/UAAAAGnRSTlMA2CcEo+6AQT7+2IOBJxPl27alhoBnX15SCCe258UAAAB+SURBVEjH7dA5EoAgEERR3BcQ923Q+1/T0SqKlNbMouP3gxkRFvZpyQb64VSQT4mOcYc8mU5DnqIG8zXoozj4d34tML+YrET8XBFx4e2F4oAL4N7J3EUB/EfSUwD/zG3hvFdROu9XtL31vgXguQA9F6DnAvM8WbOHpkXYD3cBBCcPjtASYjwAAAAASUVORK5CYII=');
      }

      .instructions ::content code {
        font-family: 'Source Code Pro', Helvetica, Arial;
        font-size: 13px;
        color: #333;
        background-color: rgba(0, 0, 0, 0.08);
        border-radius: 2px;
        overflow-x: auto;
        padding: 0.1em 0.3em;
      }

      .instructions ::content pre {
        font-family: 'Source Code Pro', Helvetica, Arial;
        font-size: 13px;
        color: white;
        background-color: #28323f;
        padding: 14px;
        line-height: 16px;
        overflow-x: auto;
        @apply(--gcb-step-card-code);
      }

      .instructions ::content pre > code {
        padding: 0;
        background-color: transparent;
        @apply(--gcb-step-card-code);
      }

      .instructions ::content code em {
        color: #97C8F2;
      }

      .instructions ::content table code,
      .instructions ::content h2 code {
        background: white;
      }

      .instructions ::content .indented {
        margin-left: 40px;
      }

      .instructions ::content strong {
        font-weight: 600;
      }

      .instructions ::content paper-button a {
        text-decoration: none;
      }

      .instructions ::content paper-button.colored {
        background-color: #0F9D58;
        color: #fff;
      }

      .instructions ::content paper-button.colored a,
      .instructions ::content paper-button.colored a:visited {
        color: #fff;
      }

      .instructions ::content paper-button.red {
        background-color: #DB4437;
      }

      .instructions ::content img {
        max-width: 100%;
        width: 100%;
        vertical-align: bottom;
      }

      .instructions ::content table {
        border-spacing: 0;
      }

      .instructions ::content td {
        vertical-align: top;
        border-bottom: 1px solid #CCC;
        padding: 8px;
      }

      .instructions ::content table p {
        margin: 0;
      }

      .instructions ::content h3.faq {
        border-bottom: 1px solid #ddd;
      }

      .instructions ::content ul.faq {
        list-style: none;
        padding-left: 1em;
      }

      .instructions ::content .faq li {
        font-size: 1.1em;
        margin-bottom: 0.8em;
      }

      .instructions ::content .faq a {
        color: inherit;
        text-decoration: none;
      }

      .instructions ::content .faq a:hover {
        text-decoration: underline;
      }

      .instructions ::content .faq a[href*="stackoverflow.com"] {
        padding-left: 22px;
        background-size: 24px;
        background-repeat: no-repeat;
        background-image: url('data:image/png;base64,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');
      }

      .instructions ::content .faq a[href*="support.google.com/webmasters/"] {
        padding-left: 24px;
        background-size: 24px;
        background-repeat: no-repeat;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAolBMVEUAAADW1tbW1tZ6enrQ0dJ6enrMzMzq6+zq6+x6enru7+/m5+ju7+/m5+j////S09REi/XW1tbm5+ju7+9PT0/Q0dK8vLxGjfVZWVlNTU16enrMzMzIyMj09PS/0uuSkpJpaWmbm5tim/e0tLSEhIStx+3e3+GsrKxwcHBZk/dPk/R1p/KPtu/U3eqmpqZlZWVfmO5woeqHreWvwN6nu9qLi4vZSE73AAAADnRSTlMAEcxmzO7MzDMz7u6IiHn/rpYAAALMSURBVHja7dXpjtowFIZhUkqZlSV1ncQdEsK+zD7T+7+1xjTiwxVOAmeORyP5+2UspPchEtDy8/Pz8/Pz8/M7cZeduHKdyxbL0FfVAMUraHdUHUB12i22tZWqBRSDgKFfC4CApV8PgIClXw/gE6hyTd/lAR7gAV8fEHwbWtc/ul/WfQ8IfQKAIECfCoCA3sdq+nQB+nQABIQ+CQABtY9Z+lQB+gwACBj6AFAE6DM9AL0fAalPB/yGgNAfntwHAAJKnwCAwNLneQAAVAvM/ttzVLlB4z2/A6AFVoDRf43IfewVgGKNAG/Uvrl39BsCXqh9cy8nA/51tmk63+jDZp6m9wTA4DzANiyW6lOqTxAMHAD22XASReuwpKDvELCNookBGJwx9E8B3OvsQp8e9GmOviNANA/Dh4k+TApBukHfFSBa7/I7whqf3xWA/gOAoU8DDJwBCHk+wIAw9CsAPw/W++CFB/MAD/hCgL59PXPS8toRYKHEndkTauEQIIUQ0hToG2eAXOicKdBXmSPAo9CTpkDo5U4Ad6IEGILy0gFgFJctCACIh/yATABwIChvVyE3IBR7AAQAiOmIGZADAMEBQMkRL+AJAAgOALGUI07AQgBgCPb3uRbwAaYAGAIAZlIL2AA5AIYAgJXUAjaAAsAQADCWO4EjAAQGQAvYAUsDsDQAeuwAMZvu89PZ/jZhBmQCi2dl60+MPiMAf8UgZEUpK/LoJ4oX0C9LIIyF0U8yXkBPVCzRWzIDZjX9sWQG9Kv7ScYN6KnKfizZAf2qfpLzA3p5RV9JboDeytp/kk4Ao5WtP+UFQKCO9sdTSQQ03+OR/kxKdgAWZv/11VI6AWBmP5HSNQD5zwQknwxIqIBu468hBgDqNYCuFXBDASSNAbdWQHB1PiBpDLgOWtZdXPEDri/QswjYAOjbF9x0OQHd26Dl5+fn5+fn5+dn7i/3LEaKJNV/0wAAAABJRU5ErkJggg==');
      }

      .instructions ::content .faq a[href*="developer.android.com"],
      .instructions ::content .faq a[href*="android-developer"] {
        padding-left: 20px;
        background-repeat: no-repeat;
        background-size: 20px;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAq1BMVEX///+lyjmfxyGhyCqkyjakyTP+/vuiyS7z+OWlyjKgxyTX57ChyCfa6bTx9uLy9+Sz0l6szk/D24Tt9NrN4ZnK4JSiyCyexh34+/D6/PTp8dPh7cjf7L7k78vc6rnW5qzU5ajS5KPP4p+21GWnzD3F3Yi813Kx0ViqzUWexhr8/vjv9d7Z6LKy0lyZxADh7cLA2n2rzkr1+erJ35C61m6uz1KcxRHn8M6/2XgEePWtAAACr0lEQVRo3u3Z2XKiQBiG4Y9ebNO2aCCyzOC+7zH7/V/ZRJZQZaJpWnKS4TlJUItXbX4pFJXK71DTusvccI6z5oMSAutdhDP2uzpK4CxwxsRBGYJdA19qLAOU4s4LkyUN7G4Ude2glmzuRihHKDqAPZhNuJRKSckms37rvctrKMnG728l5cxKMU7JuCF7KEvf87h1gnu0iXK4B2p9Sc3dUgZNMusMLvu42r20LiBXT8JMWRepN1xlGu+fK8/6xFPxwsvH697/eP/j7uDTOvB+dxwX/AaM2SQ+6icrYHDyGmgfWE3irNeCqTaPAwcArydroboAbuMAb8NQRNJn20SYtHK8HaKZzoffhZl5tlNxsD5PsnUQ2b9jwwnO35WvRo3lN/o2TDwKS5M3gokF0w2wZxgIlpY2FpgsgdQPkLXJQar0A/LVIDB6Idp2GxQQrJI/rbq2Voijlc5S9LZs8uYCqBVyXLTZhLW/fSn3hDMmZAQ05I020gT2PmeM+w4uGpLksFs+oEEtbaqJVnpUkz4uyebf6xQK0CY6XjoSC1xQ9/PPr4KB52zuvTrOa5EssC0auM0C0tYKtI0DqgpUgSpQBapAFfifAj90Tn5YZoGnooH8eutB56KDDosGhlTrYiTyk0epVdFAKJLn9rLHRSNfcE4tF0UDcAXlXPhDfGPtjGejEMUDCEdPY8eFHoOADvPAxiDQLBBQkUHAJfoB34UBS/9CfAETe6lZYKZft/QIFe94vicRy7tcvKOkB0PhYOo4zlNWYNvjpjOdZwU+O24OQlynK62EGCF2J9IbpIsy/P0I3CHW+Qj8qQJVoAr8VOCx3EB+YvDSwIDmXzaW4oZZseU6Lfr5aaAUPT8uyPuT33VeIpRkI5RHyRQfHEKFUj2UJuh1GjaQsxudKECl8jv8A6GtQkKSkMLrAAAAAElFTkSuQmCC');
      }

      .instructions ::content h3 > a[href*="github"],
      .instructions ::content h3 > a[href*="github"]:visited {
        color: black;
        text-decoration: none;
        padding-left: 24px;
        background-repeat: no-repeat;
        background-size: 18px;
        background-image: url('data:image/png;base64,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');
      }
    </style>
    <div class="instructions">
      <div class="inner">
        <h2 id="title"><span>{{step}}</span>. <span>{{label}}</span></h2>
        <content></content>
        <div id="data"></div>
      </div>
    </div>
    <footer>
      <template is="dom-if" if="{{feedbackLink}}">
        <div id="feedback">
          Did you find a mistake in this guide?
          <a target="_blank" href$="{{feedbackLink}}">Please file a bug</a>.
        </div>
      </template>
    </footer>
  </template>
  <script>
    Polymer({
      is: 'gcb-step-card',
      properties: {
        /**
         * Step number, starting from 1.
         * Normally set by the parent `<gcb-step-container>` element.
         */
        step: {
          type: Number,
          value: 1,
          notify: true
        },

        /**
        * An index of this step in the guide.
        */
        index: {
          type: Number,
          value: 0,
          notify: true
        },

        /**
         * Title of this step.
         */
        label: {
          type: String,
          value: ''
        },

        /**
         * How long, on average, it takes to complete the step.
         */
        duration: {
          type: Number,
          value: 0,
          notify: true
        },

        /**
         * Bug repors and feedback link.
         */
        feedbackLink: {
          type: String,
          value: ''
        },

        /**
         * Indicates whether this step is currently active.
         * Normally set by the parent `<gcb-step-container>` element.
         */
        active: {
          type: Boolean,
          notify: true,
          value: false
        },

        /**
         * Polymer DOM doesn't have the actual content; the content is in the
         * <gcb-step-card-data> node with a specific index. This property
         * helps us remember if we have already moved content that DOM into this
         * component.
         */
        materialized: {
          type: Boolean,
          notify: true,
          value: false
        }
      },
      attached: function() {
        if (!this.materialized) {
          this.materialized = true;
          var source = $('gcb-step-card-data[index=' + this.index + ']');
          var target = Polymer.dom(this.root).querySelector('div#data');
          $(source).children().each(function(){
              var element = $(this).detach();
              $(target).append(element);
          });
        }
      }

    });
  </script>
</dom-module>

<dom-module id="gcb-step-container">
  <template>
    <style include="shared-style"></style>
    <style>
      :root {
        --gcb-step-container-background: #f1f1f3;
        --gcb-step-container-header-background: #4285f4;
        --gcb-step-container-fab-background: #00BCD4;
      }

      :host {
        line-height: 24px;
        --paper-menu: {
          margin: 16px 16px 0 12px;
          background: var(--gcb-step-container-background);
        };
        --paper-drawer-panel-left-drawer-container: {
          background: var(--gcb-step-container-background);
          z-index: 10;
          overflow-y: auto;
        };
        --paper-drawer-panel-main-container: {
          background: var(--gcb-step-container-background);
        };
      }

      iron-icon {
        margin-right: 12px;
      }

      paper-toolbar {
        background: var(--gcb-step-container-header-background);
      }

      paper-fab {
        --paper-fab-keyboard-focus-background: var(--gcb-step-container-fab-background);
        --paper-fab-background: var(--gcb-step-container-fab-background);
      }

      paper-menu {
        margin-top: 0px;
        padding-top: 0px;
      }

      paper-item {
        cursor: pointer;
      }

      paper-item:focus {
        background-color: #DFE0E2;
      }


      h1 {
        font-size: 22px;
        font-weight: 300;
        line-height: 1em;
        color: white;
        padding: 0;
        margin: 0.67em 8px;
      }

      paper-toolbar ::shadow iron-icon {
        fill: rgba(255, 255, 255, 0.8);
      }

      #countdown {
        text-align: right;
        vertical-align: bottom;
        margin-right: 20px;
        font-weight: 400;
        min-width: 80px;
        color: white;
      }

      .navbutton {
        position: absolute;
        bottom: 32px;
        z-index: 5;
      }

      .navbutton.prevbutton {
        background: #999;
        left: 32px;
      }

      .navbutton.prevbutton[disabled] {
        visibility: hidden;
      }

      .navbutton.nextbutton, .navbutton.donebutton {
        right: 32px;
      }

      .navbutton.donebutton {
        --paper-fab-keyboard-focus-background: #4CAF50;
        --paper-fab-background: #4CAF50;
      }

      .title {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .toc-item {
        font-size: 14px;
        color: #8f8f8f;
        overflow: hidden;
        border-radius: 4px;
        padding: 6px 16px;
        cursor: pointer;
      }

      .toc-item i {
        display: inline-block;
        font-style: normal;
        width: 24px;
        min-width: 24px;
        background: #fff;
        border-radius: 50%;
        text-align: center;
        height: 24px;
        vertical-align: middle;
        line-height: 24px;
        border: 1px solid #BDBDBD;
        margin-right: 8px;
        font-weight: 400;
      }

      .toc-item i::before,
      .toc-item i::after {
        content: '';
        display: block;
        border-left: 1px solid #BDBDBD;
        width: 0;
        height: 44px;
        z-index: 1;
        margin-top: 1px;
      }

      .toc-item i::before {
        margin-top: -44px;
        margin-left: 11px;
      }

      .toc-item i::after {
        margin-left: 11px;
      }

      .toc-item.completed {
        color: #333333;
      }

      .toc-item.selected {
        color: #333333;
        background-color: #DFE0E2;
        font-weight: 500;
      }

      .toc-item.completed i,
      .toc-item.completed i::before,
      .toc-item.completed i::after,
      .toc-item.selected i,
      .toc-item.selected i:before {
        border-color: #00BCD4;
      }

      .toc-item:first-of-type i::before,
      .toc-item:last-of-type i::after {
        display: none;
      }
    </style>

    <iron-localstorage name="{{title}}" value="{{state}}"
        on-iron-localstorage-load-empty="_stateInit"
        on-iron-localstorage-load="_stateLoaded">
    </iron-localstorage>

    <paper-header-panel mode="seamed" id="header">
      <paper-toolbar>
        <paper-icon-button icon="menu" hidden$="{{!narrow}}" on-tap="_toggleDrawer"></paper-icon-button>
        <h1 class="title">{{title}}</h1>
        <div id="countdown" title="Time remaining" class="flex" hidden$="{{!_isPositiveNum(duration)}}">
          <iron-icon icon="schedule"></iron-icon> <span>{{remaining}}</span> min remaining
        </div>
      </paper-toolbar>

      <paper-drawer-panel narrow="{{narrow}}" selected="true" id="drawer" class="layout vertical">
        <div drawer class="fit layout vertical">
          <paper-item class="layout horizontal" on-tap="_goToHome">
            <iron-icon icon="arrow-back"></iron-icon>
            <span>Back to guides</span>
          </paper-item>
          <paper-menu id="toc">
            <template is="dom-repeat" items="{{steps}}">
              <paper-item class$="{{_tocItemClass(selected, index)}}">
                <i>{{item.step}}</i><span>{{item.label}}</span>
              </paper-item>
            </template>
          </paper-menu>
        </div>

        <div main style="overflow-y: auto" id="main" on-scroll="_trackHeaderMode">
          <neon-animated-pages id="pages" selected="{{selected}}"
              on-neon-animation-finish="_scrollIntoStepView">
            <content select="gcb-step-card"></content>
          </neon-animated-pages>
          <paper-fab raised class="navbutton prevbutton" icon="chevron-left"
            on-tap="selectPrevious"
            title="Previous step"
            disabled$="{{_isFirstStep(selected)}}">
          </paper-fab>
          <paper-fab raised class="navbutton nextbutton" icon="chevron-right"
            on-tap="selectNext"
            title="{{_nextFabTitle(selected)}}">
          </paper-fab>
          <paper-fab raised completed class="navbutton donebutton" icon="done"
            on-tap="_goToHome"
            title="Complete guide"
            hidden$="{{_hideDoneFab(selected)}}">
          </paper-fab>
        </div>
      </paper-drawer-panel>
    </paper-header-panel>

    <paper-dialog id="resumeDialog" modal>
      <h2>Would you like to resume where you left off?</h2>
      <p>Step <span>{{_storedStep.step}}</span>: <span>{{_storedStep.label}}</span></p>
      <div class="buttons">
        <paper-button dialog-dismiss on-click="_stateInit">Start Over</paper-button>
        <paper-button dialog-confirm on-click="_resume" autofocus>Resume</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>
    Polymer({
      is: 'gcb-step-container',

      behaviors: [
        Polymer.IronA11yKeysBehavior
      ],

      listeners: {
        'toc.iron-select': '_menuSelect'
      },

      properties: {
        /**
         * Guide title
         */
        title: {
          type: String,
          value: ''
        },

        /**
         * Guide color, i.e. "#FF0000"
         */
        color: {
          type: String,
          value: ''
        },

        /**
         * Guide category, e.g. 'Android'
         */
        category: {
          type: String,
          value: null
        },

        /**
         * Guide environment, e.g. 'web'
         */
        environment: {
          type: String,
          value: null
        },

        /**
         * Feedback URL for the guide bug repors.
         */
        feedbackLink: {
          type: String,
          value: ''
        },

        /**
         * Current step index, 0-based.
         * `location.hash` is synced with this number.
         */
        selected: {
          type: Number,
          value: 0,
          observer: '_selectedChanged'
        },

        /**
         * Total duration of the guide, in minutes.
         */
        duration: {
          type: Number,
          value: 0,
          readOnly: true
        },

        /**
         * Remaining time to completion, in minutes.
         */
        remaining: {
          type: Number,
          value: 0,
          readOnly: true
        },

        /**
         * Step elements of the specific guide. Currently, only `<gcb-step-card>`
         * elements are supported.
         * The steps are populated on 'attached': callback for distributed children
         * changes is still being worked on https://github.com/Polymer/polymer/issues/1773
         */
        steps: {
          type: Array,
          value: function() { return []; },
          readOnly: true
        },

        /**
         * Guide state, synced with `localStorage`.
         * See `_stateInit` for object properties.
         */
        state: {
          type: Object,
          value: null
        },

        /**
         * Last selected step before leaving the guide.
         * Used in the $.resumeDialog to prompt a user to resume the guide
         * where the left off.
         *
         * It is synced with the `state.stepIndex` one time only, when the storage
         * is loaded.
         */
        _storedStep: {
          type: Object,
          value: null
        },

        /**
         * When true, indicates that the current step change was initiated
         * from the $.resumeDialog by the user clicking on 'resume' button.
         * This is mainly to prevent firing 'gcb-step-card-event-completed' event
         * every time users return to a guide they've actually already done.
         */
        _resumed: {
          type: Boolean,
          value: false
        }
      },

      keyBindings: {
        'left up pageup': 'selectPrevious',
        'right down pagedown': 'selectNext',
      },

      _menuSelect: function(event) {
        this.async(function() {
          this.select(this.$.toc.selected);
        });
      },

      ready: function() {
        // select the step early, before localStorage is loaded
        this._updateStepIndexFromUrl();
      },

      attached: function() {
        var duration = 0;
        var steps = this.$.pages.getEffectiveChildren().map(function(item, i) {
          duration += item.duration;
          item.feedbackLink = this.feedbackLink;
          item.step = i + 1;
          return item;
        }.bind(this));
        this._setSteps(steps);
        this._setDuration(duration);
        this._updateRemaining();

        this.async(function(){
          window.addEventListener('popstate', this._updateStepIndexFromUrl.bind(this));
        });

        if (this.color) {
            this.customStyle['--gcb-step-container-header-background'] = this.color;
            this.updateStyles();
        }
        this.fire('gcb-step-card-event-selected', {
          index: this.selected,
          step: this.steps[this.selected]
        });
      },

      /**
       * Advance one step of the guide.
       */
      selectNext: function() {
        this.$.pages.entryAnimation = 'slide-from-right-animation';
        this.$.pages.exitAnimation = 'slide-left-animation';
        this.select(this.selected + 1);
      },

      /**
       * Go one step backwards.
       */
      selectPrevious: function() {
        this.$.pages.entryAnimation = 'slide-from-left-animation';
        this.$.pages.exitAnimation = 'slide-right-animation';
        this.select(this.selected - 1);
      },

      /**
       * Select an arbitrary step of the guide.
       */
      select: function(stepIndex) {
        if (stepIndex < 0 || stepIndex > this.steps.length - 1) {
          this.$.toc.select(this.selected);
          return;
        }
        this.selected = stepIndex;
        this.$.toc.select(this.selected);

        this._updateUrlFromSelected();
      },

      _stateInit: function() {
        this.state = {stepIndex: this.selected};
      },

      _selectedChanged: function() {
        this.set('state.stepIndex', this.selected);
        this._updateRemaining();
        // we can't set location.hash here because of a race condition:
        // _selectedChanged may be called before _updateStepIndexFromUrl

        if (!this.steps) {
          return;
        }
        this.fire('gcb-step-card-event-selected', {
          index: this.selected,
          step: this.steps[this.selected]
        });
        if (this.selected === this.steps.length - 1 && !this._resumed) {
          this.fire('gcb-step-card-event-completed');
        }

        this.$.drawer.closeDrawer();
      },

      _stateLoaded: function() {
        // allow everything render and initialize,
        // especially this.steps which runs at the same init level
        // as iron-localstorage (on attached).
        this.async(function() {
          this._storedStep = this.steps[this.state.stepIndex];
          // resume dialog is shown only when all 3 conditions hold:
          // 1. user has already visited the guide in the past
          // 2. has made at least 1 step
          // 3. user is landed on the first step
          if (this.selected === 0 && this.state.stepIndex > 0) {
            this.$.resumeDialog.open();
          }
        }, 500);
      },

      _updateStepIndexFromUrl: function() {
        var step = parseInt(location.hash.slice(1));
        if (isNaN(step) || step < 0) {
          step = 0;
        }
        if (this.steps && this.steps.length && step > this.steps.length - 1) {
          step = this.steps.length - 1;
        }
        this.selected = step;
        this.$.toc.select(this.selected);
      },

      _updateUrlFromSelected: function() {
        if (!isNaN(this.selected)) {
          location.hash = this.selected;
        }
      },

      _updateRemaining: function() {
        if (!this.steps) {
          return;
        }
        var remain = 0;
        this.steps.slice(this.selected).forEach(function(item) {
          remain += (item.duration || 0);
        });
        this._setRemaining(remain);
      },

      _resume: function() {
        this._resumed = true;
        this.select(this.state.stepIndex);
        this._resumed = false;
      },

      _goToHome: function () {
        window.location.href = '/modules/guides';
      },

      _trackHeaderMode: function() {
        this.$.header.shadow = this.$.main.scrollTop > 0;
      },

      _toggleDrawer: function() {
        this.$.drawer.togglePanel();
      },

      _tocItemClass: function(selected, i) {
        var cls = ['toc-item'];
        if (i < selected) {
          cls.push('completed');
        }
        if (i == selected) {
          cls.push('selected');
        }
        return cls.join(' ');
      },

      _scrollIntoStepView: function() {
        this.steps[this.selected].scrollIntoView();
      },

      _isPositiveNum: function(duration) {
        return duration > 0;
      },

      _isFirstStep: function(stepIndex) {
        return isNaN(stepIndex) || stepIndex == 0;
      },

      _isLastStep: function(stepIndex) {
        if (isNaN(stepIndex) || !this.$.pages.getEffectiveChildren()) {
          return true;
        }
        var items = this.$.pages.getEffectiveChildren();
        return items && items.length && stepIndex >= items.length - 1;
      },

      _hideDoneFab: function(stepIndex) {
        return !this._isLastStep(stepIndex);
      },

      _nextFabTitle: function(stepIndex) {
        return stepIndex > 0 ? 'Next step' : 'Start guide';
      }
    });
  </script>
</dom-module>
